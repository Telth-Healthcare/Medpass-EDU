import{r as n,j as e,t as C,v as D,w as P}from"./index-D2RzZOxE.js";const R=()=>{const[m,N]=n.useState(""),[l,h]=n.useState(""),[o,b]=n.useState(""),[c,y]=n.useState(""),[u,w]=n.useState(null),[p,x]=n.useState(!1),[S,f]=n.useState(!1),[v,s]=n.useState(""),[j,E]=n.useState();n.useEffect(()=>{(async()=>{var d;const r=new URLSearchParams(window.location.search).get("token");if(!r){s("Invalid or missing invitation token.");return}w(r),f(!0),s("");try{const a=await C(r);if(a.email&&h(a.email),a.role&&y(a.role),a.is_used){s("This invitation has already been used.");return}if(a.expires_at&&new Date(a.expires_at)<new Date){s("This invitation has expired.");return}}catch(a){console.error("Error fetching invite data:",a),a.code==="ECONNREFUSED"?s("Cannot connect to server. Please check if the backend is running."):((d=a.response)==null?void 0:d.status)===404?s("Invitation not found or invalid token."):s("Invalid or expired invitation link.")}finally{f(!1)}})()},[]);const k=async t=>{if(t.preventDefault(),s(""),!m.trim()||!o.trim()||!u||!c){s("All fields are required.");return}if(o.length<6){s("Password must be at least 6 characters long.");return}if(!l.includes("@")){s("Please enter a valid email address.");return}try{x(!0);const i={username:m,email:l,password:o,role:c.toUpperCase(),token:u,phone:j},r=await D.post(`${P}users/`,i,{headers:{"Content-Type":"application/json",Accept:"application/json"},timeout:3e4});(r.status===200||r.status===201)&&(alert("Signup successful! Redirecting to login..."),setTimeout(()=>{window.location.href="/login"},1e3))}catch(i){if(console.error("Signup error:",i),i.response&&i.response.data){const r=i.response.data,d=Object.entries(r).map(([a,g])=>`${a}: ${g.join(", ")}`).join(" | ");s(d||"Signup failed. Please try again.")}else s("Network error. Please check your connection.")}finally{x(!1)}};return S?e.jsx("div",{className:"container-fluid vh-100 d-flex justify-content-center align-items-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"spinner-border text-primary",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Loading..."})}),e.jsx("p",{className:"mt-2",children:"Verifying invitation..."})]})}):e.jsx("div",{className:"container-fluid vh-100",children:e.jsxs("div",{className:"row h-100",children:[e.jsx("div",{className:"col-md-6 d-flex justify-content-center align-items-center bg-light",children:e.jsxs("div",{className:"card shadow p-4 mt-5 w-100",style:{maxWidth:"400px"},children:[e.jsx("h3",{className:"text-center mb-4",children:"Complete Your Signup"}),v&&e.jsx("div",{className:"alert alert-danger py-2",children:v}),e.jsxs("form",{onSubmit:k,children:[e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Username *"}),e.jsx("input",{type:"text",className:"form-control",value:m,onChange:t=>N(t.target.value),placeholder:"Enter your username",required:!0})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Email *"}),e.jsx("input",{type:"email",className:"form-control",value:l,onChange:t=>h(t.target.value),readOnly:!!l,required:!0})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Password *"}),e.jsx("input",{type:"password",className:"form-control",value:o,onChange:t=>b(t.target.value),placeholder:"Min. 6 characters",required:!0})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Role *"}),e.jsx("input",{type:"text",className:"form-control",value:c,readOnly:!0})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Mobile Number"}),e.jsx("input",{type:"number",className:"form-control",value:j,onChange:t=>E(t.target.value),placeholder:"Min. 10 characters",required:!0})]}),e.jsx("button",{type:"submit",className:"btn btn-primary w-100",disabled:p||!u||!c,children:p?"Signing up...":"Sign Up"})]})]})}),e.jsx("div",{className:"col-md-6 d-none d-md-flex bg-primary text-white justify-content-center align-items-center",children:e.jsxs("div",{className:"text-center px-5",children:[e.jsx("h1",{className:"mb-3",children:"Welcome!"}),e.jsx("p",{className:"lead",children:"You've been invited to join us. Create your account and get started!"}),l&&e.jsx("div",{className:"mt-4",children:e.jsxs("small",{className:"opacity-75",children:["Invitation for: ",e.jsx("strong",{children:l})]})})]})})]})})};export{R as default};
