import{u as F,r as c,j as e,k as T,T as v,L as q,l as N,m as O,y as p,o as B,n as W,s as R,p as z,q as U}from"./index-D2RzZOxE.js";import{I as $,V as H}from"./VisibilityOff-OVoZowFg.js";import{I as K}from"./IconButton-CrdpUguL.js";import{V as G}from"./Visibility-gAEE29Hq.js";import{F as J,C as Q}from"./FormControlLabel-BkPtrJae.js";import{D as X,a as Y,b as Z,c as _}from"./DialogTitle-BOh6f4ps.js";function le(){const S=F(),[g,k]=c.useState(!1),[D,y]=c.useState(!1),[u,x]=c.useState(""),[m,h]=c.useState(!1),[t,I]=c.useState({userName:"",email:"",password:"",rememberMe:!1}),[n,i]=c.useState({userName:!1,password:!1,otp:!1}),[f,b]=c.useState({userName:!1,password:!1,otp:!1}),w=r=>{const{name:s,value:l,checked:d,type:a}=r.target;I(o=>({...o,[s]:a==="checkbox"?d:l})),n[s]&&i(o=>({...o,[s]:!1}))},P=r=>{b(s=>({...s,[r]:!0})),r==="userName"&&!t.userName.trim()&&i(s=>({...s,userName:!0})),r==="password"&&!t.password.trim()&&i(s=>({...s,password:!0}))},M=()=>k(!g),E=()=>{const r={userName:!t.userName.trim(),password:!t.password.trim()};return i(s=>({...s,...r})),b(s=>({...s,userName:!0,password:!0})),!r.userName&&!r.password},A=async r=>{var s,l,d,a;if(r&&r.preventDefault(),console.log("Starting login process...",t),!E()){p.error("Please fill in all required fields");return}try{h(!0),console.log("Calling otpVerfiyAPi with:",{username:t.userName,password:t.password});const o=await B({username:t.userName,password:t.password});console.log("OTP API Response:",o),y(!0),p.success("OTP sent successfully! Please check your phone/email.")}catch(o){console.error("Login error:",o);const j=((l=(s=o==null?void 0:o.response)==null?void 0:s.data)==null?void 0:l.detail)||((a=(d=o==null?void 0:o.response)==null?void 0:d.data)==null?void 0:a.message)||(o==null?void 0:o.message)||"Invalid credentials";p.error(`Login failed: ${j}`)}finally{h(!1)}},L=async()=>{var r,s,l,d;if(!u||u.length!==6){i(a=>({...a,otp:!0})),p.error("Please enter a valid 6-digit OTP");return}try{h(!0),console.log("Calling loginApi with:",{username:t.userName,password:t.password,otp:u});const a=await W({username:t.userName,password:t.password,otp:u});R(t),z({access:a.access,refresh:a.refresh,role:a.role}),x(""),p.success("Login successful!"),U(t.rememberMe),S("/dashboard")}catch(a){console.error("OTP verification error:",a);const o=((s=(r=a==null?void 0:a.response)==null?void 0:r.data)==null?void 0:s.detail)||((d=(l=a==null?void 0:a.response)==null?void 0:l.data)==null?void 0:d.message)||(a==null?void 0:a.message)||"OTP verification failed";p.error(`OTP verification failed: ${o}`),x(""),i(j=>({...j,otp:!0}))}finally{h(!1)}},V=r=>{const s=r.target.value.replace(/\D/g,"");s.length<=6&&(x(s),n.otp&&i(l=>({...l,otp:!1})))},C=()=>{y(!1),x(""),i(r=>({...r,otp:!1}))};return e.jsxs("div",{className:"min-h-screen flex flex-col md:flex-row",children:[e.jsx("div",{className:"flex-1 flex items-center justify-center p-6 bg-white",children:e.jsx(T,{sx:{width:"100%",maxWidth:400,borderRadius:4,boxShadow:"5px 5px 10px 2px rgba(7, 66, 143, 0.58)"},className:"p-8 w-full",children:e.jsxs("form",{onSubmit:A,children:[e.jsx("h1",{className:"text-2xl font-bold text-center mb-6",children:"Sign In"}),e.jsx(v,{fullWidth:!0,name:"userName",label:"Username",placeholder:"Enter your username",value:t.userName,onChange:w,onBlur:()=>P("userName"),required:!0,error:n.userName&&f.userName,helperText:n.userName&&f.userName?"Username is required":"",sx:{mb:2},variant:"outlined"}),e.jsx(v,{fullWidth:!0,name:"password",label:"Password",type:g?"text":"password",placeholder:"Enter your password",value:t.password,onChange:w,onBlur:()=>P("password"),required:!0,error:n.password&&f.password,helperText:n.password&&f.password?"Password is required":"",sx:{mb:1},variant:"outlined",InputProps:{endAdornment:e.jsx($,{position:"end",children:e.jsx(K,{onClick:M,size:"small",children:g?e.jsx(H,{}):e.jsx(G,{})})})}}),e.jsxs(T,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:1},children:[e.jsx(J,{control:e.jsx(Q,{name:"rememberMe",checked:t.rememberMe,onChange:w,color:"primary"}),label:"Remember me"}),e.jsx(q,{to:"/forgetemail",className:"text-blue-600 hover:underline text-sm",children:"Forgot password?"})]}),e.jsx(N,{fullWidth:!0,variant:"contained",type:"submit",disabled:m,size:"large",sx:{py:1.5,backgroundColor:"#1976d2","&:hover":{backgroundColor:"#1565c0"},"&:disabled":{backgroundColor:"#90caf9"}},children:m?e.jsx(O,{size:24,color:"inherit"}):"Sign In"})]})})}),e.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center p-6 bg-gradient-to-r from-blue-500 to-purple-600 text-white",children:[e.jsxs("div",{className:"spinner mb-6 ",children:[e.jsx("div",{}),e.jsx("div",{}),e.jsx("div",{}),e.jsx("div",{}),e.jsx("div",{}),e.jsx("div",{}),e.jsx("div",{}),e.jsx("div",{}),e.jsx("div",{}),e.jsx("div",{})]}),e.jsx("h1",{className:"text-3xl font-bold mb-3",children:"Hello,Future Doctors!"}),e.jsx("p",{className:"text-lg",children:"Enter your details and start your journey"})]}),e.jsxs(X,{open:D,onClose:C,maxWidth:"sm",fullWidth:!0,disableEscapeKeyDown:m,children:[e.jsx(Y,{children:"Enter OTP"}),e.jsx(Z,{children:e.jsx(v,{fullWidth:!0,label:"OTP",placeholder:"Enter 6-digit OTP",value:u,onChange:V,onBlur:()=>b(r=>({...r,otp:!0})),sx:{mt:2},inputProps:{maxLength:6,inputMode:"numeric",pattern:"[0-9]*"},variant:"outlined",required:!0,error:n.otp,helperText:n.otp?"OTP must be exactly 6 digits":"",autoFocus:!0})}),e.jsxs(_,{children:[e.jsx(N,{onClick:C,disabled:m,children:"Cancel"}),e.jsx(N,{onClick:L,disabled:m||u.length!==6,variant:"contained",children:m?e.jsx(O,{size:20,color:"inherit"}):"Verify"})]})]})]})}export{le as default};
